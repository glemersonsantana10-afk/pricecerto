<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Price ‚Äî Market</title>
<link rel="icon" href="icon.png" />
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#93a5c4;
    --accent:#47b7ff;
    --accent-2:#6dd3ff;
    --glass: rgba(255,255,255,0.03);
    --danger:#ff6b6b;
    --radius:14px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:linear-gradient(180deg, var(--bg), #081124 120%);
    color:#eef6ff;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:14px;
  }

  /* Top bar */
  .top {
    display:flex;
    gap:12px;
    align-items:center;
    margin-bottom:10px;
  }
  .logo {
    display:flex;
    align-items:center;
    gap:10px;
    background:var(--card);
    padding:8px 12px;
    border-radius:999px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
  }
  .logo img{ width:36px; height:36px; border-radius:8px; object-fit:cover }
  .logo h1{ margin:0; font-size:1rem; letter-spacing:0.6px }

  .searchWrap{
    flex:1;
    display:flex;
    align-items:center;
    gap:8px;
    background:var(--card);
    padding:8px 12px;
    border-radius:999px;
  }
  .searchWrap input{
    background:transparent; border:0; outline:0; color:inherit; width:100%;
    font-size:0.95rem;
  }
  .filterBtn{
    background:linear-gradient(180deg,var(--accent),var(--accent-2));
    border:none; padding:8px 10px; border-radius:10px; color:#062031; font-weight:700;
  }

  /* Sections */
  .sectionTitle{
    margin:16px 0 6px 0;
    display:flex; justify-content:space-between; align-items:center;
  }
  .sectionTitle h2{ margin:0; font-size:1rem }
  .sectionTitle small{ color:var(--muted); font-size:0.85rem }

  /* Cards grid */
  .grid{
    display:grid;
    grid-template-columns: repeat(2, 1fr);
    gap:12px;
  }
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), var(--glass));
    padding:10px;
    border-radius:12px;
    box-shadow: 0 4px 14px rgba(2,6,23,0.6);
    display:flex;
    flex-direction:column;
    gap:8px;
    min-height:120px;
  }
  .card .img{
    height:70px;
    border-radius:10px;
    background:#0b2540;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
  }
  .card img{ width:100%; height:100%; object-fit:cover }

  .card .title{ font-weight:700; font-size:0.95rem }
  .card .priceRow{ display:flex; justify-content:space-between; align-items:center; gap:8px }
  .price{ font-weight:800; color:var(--accent-2) }
  .oldPrice{ text-decoration:line-through; color:rgba(255,255,255,0.25); font-size:0.85rem }

  .chip{ background:rgba(255,255,255,0.03); padding:6px 8px; border-radius:999px; font-size:0.8rem; color:var(--muted) }

  /* Buttons */
  .btn{
    border:0; padding:8px 10px; border-radius:10px; cursor:pointer;
  }
  .btn-primary{ background:var(--accent); color:#042033; font-weight:700 }
  .btn-ghost{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03) }

  /* bottom nav */
  .nav{
    position:fixed; left:14px; right:14px; bottom:16px;
    display:flex; gap:8px; justify-content:space-between;
  }
  .nav a{
    flex:1; text-align:center; padding:10px 12px; border-radius:12px; text-decoration:none; color:inherit;
    background:var(--card);
  }
  .nav a.active{ box-shadow:0 6px 20px rgba(4,10,25,0.6); border:1px solid rgba(255,255,255,0.02) }

  /* form */
  form{ display:flex; flex-direction:column; gap:10px; padding:6px 0 60px 0 }
  label{ font-size:0.85rem; color:var(--muted) }
  input[type=text], input[type=number], textarea, select {
    background:transparent; border:1px solid rgba(255,255,255,0.05);
    padding:10px; border-radius:10px; color:inherit; outline:none;
  }
  textarea{ min-height:100px; resize:vertical; }

  .row{ display:flex; gap:8px }
  .row .col{ flex:1 }

  .actions{ display:flex; gap:8px; margin-top:6px }
  .small { font-size:0.85rem; color:var(--muted) }

  /* responsive */
  @media(min-width:600px){
    .grid{ grid-template-columns: repeat(3, 1fr) }
  }
</style>
</head>
<body>
  <div id="app">
    <!-- TOP -->
    <div class="top">
      <div class="logo">
        <img src="icon.png" alt="price" onerror="this.style.display='none'">
        <h1>Price</h1>
      </div>

      <div class="searchWrap">
        <input id="searchInput" placeholder="Pesquisar produtos..." />
        <button class="filterBtn" id="searchBtn">Pesquisar</button>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <main id="view"></main>

    <!-- NAV -->
    <nav class="nav">
      <a href="#home" id="navHome" class="active">In√≠cio</a>
      <a href="#list" id="navList">Consulta</a>
      <a href="#add" id="navAdd">Cadastrar</a>
    </nav>
  </div>

<script>
/* ===== Simple SPA routing ===== */
const view = document.getElementById('view');
const searchInput = document.getElementById('searchInput');
const searchBtn = document.getElementById('searchBtn');

const STORAGE_KEY = 'price_products_v1';

/* Helpers */
function readStorage(){ 
  try{
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  }catch(e){ return [] }
}
function writeStorage(v){ localStorage.setItem(STORAGE_KEY, JSON.stringify(v)); }
function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }

/* sample seed if empty (only first load) */
if(!localStorage.getItem(STORAGE_KEY)){
  const sample = [
    { id: uid(), image:"img/exemplo1.jpg", produto:"Camiseta b√°sica", descricao:"Malha leve", preco:27.15, promocao:false, empresa:"Loja A", local:"S√£o Paulo" },
    { id: uid(), image:"img/exemplo2.png", produto:"Rel√≥gio esportivo", descricao:"Resistente a √°gua", preco:45.99, promocao:true, empresa:"TimeTech", local:"Rio" },
    { id: uid(), image:"img/exemplo3.jpg", produto:"√ìculos de sol", descricao:"Prote√ß√£o UV", preco:32.00, promocao:false, empresa:"ModaX", local:"Belo Horizonte" }
  ];
  writeStorage(sample);
}

/* ROUTES */
function route(){
  const hash = location.hash.replace('#','') || 'home';
  // set active nav
  document.querySelectorAll('.nav a').forEach(a => a.classList.toggle('active', a.getAttribute('href') === '#'+hash));
  if(hash === 'home') renderHome();
  else if(hash === 'add') renderAdd();
  else if(hash === 'list') renderList();
  else if(hash.startsWith('edit:')) {
    const id = hash.split(':')[1];
    renderAdd(id);
  } else {
    renderHome();
  }
}

/* RENDER HOME: destaques e produtos mais baratos */
function renderHome(){
  const products = readStorage();
  const highlights = products.filter(p => p.promocao).slice(0,6);
  const cheapest = [...products].sort((a,b)=> a.preco - b.preco).slice(0,6);

  view.innerHTML = `
    <section>
      <div class="sectionTitle">
        <h2>Destaques</h2>
        <small>${highlights.length} encontrados</small>
      </div>
      <div class="grid" id="highlights">
        ${highlights.map(p => cardHTML(p)).join('')}
      </div>

      <div class="sectionTitle" style="margin-top:14px">
        <h2>Mais baratos</h2>
        <small>${cheapest.length} encontrados</small>
      </div>
      <div class="grid" id="cheapest">
        ${cheapest.map(p => cardHTML(p)).join('')}
      </div>
    </section>
  `;
  setupCardButtons();
}

/* RENDER LIST (consulta) */
function renderList(){
  const products = readStorage();
  const q = searchInput.value.trim().toLowerCase();
  const filtered = products.filter(p => {
    if(!q) return true;
    return (p.produto||'').toLowerCase().includes(q)
        || (p.descricao||'').toLowerCase().includes(q)
        || (p.empresa||'').toLowerCase().includes(q);
  });

  view.innerHTML = `
    <section>
      <div class="sectionTitle">
        <h2>Consulta</h2>
        <small>${filtered.length} produtos</small>
      </div>

      <div class="grid">
        ${filtered.map(p => listCardHTML(p)).join('')}
      </div>
    </section>
  `;
  setupCardButtons();
}

/* RENDER ADD (novo ou editar) */
function renderAdd(editId = null){
  const editing = editId ? readStorage().find(p=>p.id===editId) : null;
  view.innerHTML = `
    <section>
      <div class="sectionTitle">
        <h2>${editing? 'Editar produto' : 'Cadastrar produto'}</h2>
        <small>${editing? 'Atualize os campos' : 'Preencha e salve'}</small>
      </div>

      <form id="productForm">
        <label>Imagem (referenciar existente em img/ ou enviar novo arquivo)</label>
        <div class="row">
          <div class="col">
            <input list="imglist" id="imageRef" placeholder="Ex: img/meu-produto.jpg">
            <datalist id="imglist">
              <!-- user can add options manually if desired -->
              <option value="img/exemplo1.jpg">
              <option value="img/exemplo2.png">
              <option value="img/exemplo3.jpg">
            </datalist>
            <div class="small">ou selecione um arquivo (ser√° salvo no navegador):</div>
            <input type="file" id="imageFile" accept="image/*">
          </div>
        </div>

        <label>Produto</label>
        <input id="produto" type="text" required>

        <label>Descri√ß√£o</label>
        <textarea id="descricao"></textarea>

        <div class="row">
          <div class="col">
            <label>Pre√ßo (R$)</label>
            <input id="preco" type="number" step="0.01" min="0">
          </div>
          <div class="col">
            <label>Promo√ß√£o</label>
            <select id="promocao">
              <option value="false">N√£o</option>
              <option value="true">Sim</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label>Empresa</label>
            <input id="empresa" type="text">
          </div>
          <div class="col">
            <label>Local</label>
            <input id="local" type="text">
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary">${editing? 'Salvar altera√ß√µes' : 'Cadastrar'}</button>
          <a href="#home" class="btn btn-ghost">Cancelar</a>
          ${editing ? '<button id="delBtn" type="button" class="btn" style="background:var(--danger)">Excluir</button>' : ''}
        </div>
      </form>
    </section>
  `;

  // prefill
  if(editing){
    document.getElementById('imageRef').value = editing.image || '';
    document.getElementById('produto').value = editing.produto || '';
    document.getElementById('descricao').value = editing.descricao || '';
    document.getElementById('preco').value = editing.preco ?? '';
    document.getElementById('promocao').value = editing.promocao ? 'true' : 'false';
    document.getElementById('empresa').value = editing.empresa || '';
    document.getElementById('local').value = editing.local || '';
  }

  // handle submit
  const form = document.getElementById('productForm');
  form.onsubmit = async (e) => {
    e.preventDefault();
    const imageRef = document.getElementById('imageRef').value.trim();
    const imageFile = document.getElementById('imageFile').files[0];
    let imageValue = imageRef || '';

    if(imageFile){
      imageValue = await fileToDataURL(imageFile);
    } else if(!imageValue){
      // fallback placeholder tiny image (SVG data)
      imageValue = 'data:image/svg+xml;utf8,' + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="100%" height="100%" fill="#0b1220"/></svg>');
    }

    const obj = {
      id: editing ? editing.id : uid(),
      image: imageValue,
      produto: document.getElementById('produto').value.trim(),
      descricao: document.getElementById('descricao').value.trim(),
      preco: Number(document.getElementById('preco').value || 0),
      promocao: document.getElementById('promocao').value === 'true',
      empresa: document.getElementById('empresa').value.trim(),
      local: document.getElementById('local').value.trim()
    };

    const all = readStorage();
    if(editing){
      const idx = all.findIndex(p=>p.id===editing.id);
      if(idx>=0) all[idx] = obj;
    } else {
      all.push(obj);
    }
    writeStorage(all);
    location.hash = '#home';
  };

  // delete
  if(editing){
    document.getElementById('delBtn').onclick = () => {
      if(confirm('Excluir este produto?')) {
        const all = readStorage().filter(p => p.id !== editing.id);
        writeStorage(all);
        location.hash = '#list';
      }
    };
  }
}

/* CARD HTML generation */
function cardHTML(p){
  return `
    <div class="card" data-id="${p.id}">
      <div class="img">
        <img src="${escapeAttr(p.image)}" alt="${escapeAttr(p.produto)}" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;400&quot; height=&quot;300&quot;><rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;%230b2540&quot;/></svg>'">
      </div>
      <div class="title">${escapeHtml(p.produto)}</div>
      <div class="small">${escapeHtml(p.empresa)} ¬∑ ${escapeHtml(p.local)}</div>
      <div class="priceRow">
        <div><span class="price">R$ ${Number(p.preco).toFixed(2)}</span></div>
        <div style="display:flex;gap:6px">
          <button class="btn" onclick="shareProduct('${p.id}')">üîó</button>
          <a href="#edit:${p.id}" class="btn btn-ghost">‚úèÔ∏è</a>
        </div>
      </div>
    </div>
  `;
}
function listCardHTML(p){
  return `
    <div class="card" data-id="${p.id}">
      <div style="display:flex;gap:10px">
        <div style="width:28%; border-radius:10px; overflow:hidden;">
          <img src="${escapeAttr(p.image)}" alt="${escapeAttr(p.produto)}" style="width:100%; height:100%; object-fit:cover" onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;400&quot; height=&quot;300&quot;><rect width=&quot;100%&quot; height=&quot;100%&quot; fill=&quot;%230b2540&quot;/></svg>'">
        </div>
        <div style="flex:1">
          <div class="title">${escapeHtml(p.produto)}</div>
          <div class="small">${escapeHtml(p.descricao)}</div>
          <div style="margin-top:8px" class="priceRow">
            <div><span class="price">R$ ${Number(p.preco).toFixed(2)}</span></div>
            <div style="display:flex;gap:6px">
              <a href="#edit:${p.id}" class="btn btn-ghost">Editar</a>
              <button onclick="removeProduct('${p.id}')" class="btn" style="background:var(--danger); color:#fff">Apagar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  `;
}

/* Utilities */
function escapeHtml(str=''){ return String(str).replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[s]); }
function escapeAttr(s=''){ return s && s.startsWith('data:') ? s : (s||'').replace(/"/g,'&quot;'); }

/* clickable card buttons (share/edit handled inline) */
function setupCardButtons(){
  // nothing more needed since buttons inline contain actions
}

/* share / remove */
function shareProduct(id){
  const p = readStorage().find(x=>x.id===id);
  if(!p) return alert('Produto n√£o encontrado');
  // simplest share: copy JSON to clipboard
  const text = `${p.produto} ‚Äî R$ ${Number(p.preco).toFixed(2)}\n${p.descricao || ''}\nEmpresa: ${p.empresa || ''} - ${p.local || ''}`;
  navigator.clipboard?.writeText(text).then(()=> alert('Informa√ß√µes copiadas para a √°rea de transfer√™ncia'));
}

function removeProduct(id){
  if(!confirm('Confirmar exclus√£o?')) return;
  const all = readStorage().filter(p=>p.id!==id);
  writeStorage(all);
  route();
}

/* convert file to dataURL */
function fileToDataURL(file){
  return new Promise((res, rej) => {
    const reader = new FileReader();
    reader.onload = () => res(reader.result);
    reader.onerror = rej;
    reader.readAsDataURL(file);
  });
}

/* search handler */
searchBtn.onclick = () => {
  location.hash = '#list';
};
searchInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') { e.preventDefault(); location.hash = '#list'; } });

/* Listen to hash changes */
window.addEventListener('hashchange', route);
route(); // initial

</script>
</body>
</html>
