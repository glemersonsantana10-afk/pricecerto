<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App de Produtos</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Arial, sans-serif;
}

body {
  background: #0f0f0f;
  color: #fff;
}

header {
  background: #121212;
  padding: 15px;
  text-align: center;
  font-size: 20px;
  font-weight: bold;
}

nav {
  display: flex;
  background: #181818;
}

nav button {
  flex: 1;
  padding: 12px;
  background: none;
  border: none;
  color: #aaa;
  font-size: 14px;
}

nav button.active {
  color: #00ff88;
  border-bottom: 2px solid #00ff88;
}

section {
  display: none;
  padding: 15px;
}

section.active {
  display: block;
}

input, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 6px;
  border: none;
}

input {
  background: #1e1e1e;
  color: #fff;
}

button {
  background: #00ff88;
  color: #000;
  font-weight: bold;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 10px;
}

.card {
  background: #1c1c1c;
  border-radius: 8px;
  padding: 10px;
  cursor: pointer;
}

.card img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  border-radius: 6px;
}

.card h3 {
  font-size: 14px;
  margin: 5px 0;
}

.card p {
  font-size: 12px;
  color: #bbb;
}

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
}

.modal-content {
  background: #1e1e1e;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-height: 85vh;
  overflow-y: auto;
}

.modal img {
  width: 100%;
  border-radius: 8px;
  margin-bottom: 10px;
}

.barra-pesquisa {
  display: flex;
  gap: 6px;
  margin-bottom: 10px;
}

.barra-pesquisa input {
  flex: 1;
  width: auto;
}

.barra-pesquisa button {
  width: 50px;
  padding: 10px;
}

.barra-pesquisa input,
.barra-pesquisa button {
  border-radius: 20px;
}

</style>
</head>
<body>

<header>üì¶ App de Produtos</header>

<!--bt trocar abas-->
<nav>
<button onclick="trocarAba('inicio', this)" class="active">In√≠cio</button>
<button onclick="trocarAba('cadastrar', this)">Cadastrar</button>
<button onclick="trocarAba('editar', this)">Editar</button>
<button onclick="trocarAba('produtos', this)">Produtos</button>
</nav>
<!--bt trocar abas-->
<section id="inicio" class="active">
  <h3>üî• Mais baratos</h3>
  <div class="cards" id="inicioCards"></div>
</section>

<section id="cadastrar">
  <input id="produto" placeholder="Produto">
  <input id="preco" type="number" placeholder="Pre√ßo">
  <input id="promo" placeholder="Promo√ß√£o">
  <input id="local" placeholder="Local">
  
		<!---- imagem-----> 
<input 
  id="imagem" 
  type="file" 
  accept="image/*">
		<!---- imagem----->
		
  <button onclick="salvarProduto()">Salvar</button>
</section>

<section id="editar">
  <div class="cards" id="editarCards"></div>
</section>

<section id="produtos">

		<!--pesquesar-->
<div class="barra-pesquisa">
  <input 
    id="campoBusca"
    placeholder="Pesquisar produto..."
    oninput="buscarProduto()"
  >
  <button onclick="buscarProduto()">üîç</button>
</div>
		<!--pesquesar-->
  <div class="cards" id="produtosCards"></div>
</section>

<div class="modal" id="modal">
  <div class="modal-content" id="modalContent"></div>
</div>

<script>
let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
let imagemBase64 = "";

document.getElementById("imagem").addEventListener("change", function () {
  const file = this.files && this.files[0];
  if (!file) return;

  if (!file.type.startsWith("image/")) {
    alert("Formato n√£o suportado!");
    this.value = "";
    return;
  }

  const reader = new FileReader();

  reader.onloadend = function () {
    imagemBase64 = reader.result;
  };

  reader.readAsDataURL(file);
});

function trocarAba(id, btn) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");

  document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
  btn.classList.add("active");

  if (id === "inicio") renderInicio();
  if (id === "produtos") renderProdutos(produtos);
  if (id === "editar") renderEditar();
}

function salvarProduto() {
if (!imagemBase64) {
  alert("Aguarde a imagem carregar ou selecione uma imagem v√°lida.");
  return;
}
 produtos.push({
    produto: produto.value,
    preco: Number(preco.value),
    promo: promo.value,
    local: local.value,
    imagem: imagemBase64
  });

  localStorage.setItem("produtos", JSON.stringify(produtos));

  alert("Produto cadastrado!");

  produto.value = preco.value = promo.value = local.value = "";
  imagem.value = "";
  imagemBase64 = "";

  render();
}

function render() {
  renderInicio();
  renderProdutos();
  renderEditar();
}

function renderProdutos(lista = produtos) {
  produtosCards.innerHTML = "";
  lista.forEach(p => {
    const indexReal = produtos.indexOf(p);
    produtosCards.innerHTML += cardHTML(p, indexReal);
  });
}

function renderInicio() {
  inicioCards.innerHTML = "";
  [...produtos]
    .sort((a,b)=>a.preco-b.preco)
    .slice(0,4)
    .forEach((p, i) => inicioCards.innerHTML += cardHTML(p, i));
}

function renderEditar() {
  editarCards.innerHTML = "";

  produtos.forEach((p, i) => {
    editarCards.innerHTML += `
      <div class="card">
        <h3>${p.produto}</h3>
        <p>R$ ${p.preco}</p>
        <button onclick="abrirEditar(${i})">‚úèÔ∏è Editar</button>
        <button onclick="excluir(${i})">üóëÔ∏è Excluir</button>
      </div>
    `;
  });
}

function abrirEditar(i) {
  modal.style.display = "flex";

  modalContent.innerHTML = `
    <h2>Editar Produto</h2>

    <input id="eProduto" value="${produtos[i].produto}">
    <input id="ePreco" type="number" value="${produtos[i].preco}">
    <input id="ePromo" value="${produtos[i].promo}">
    <input id="eLocal" value="${produtos[i].local}">
    <input id="eImagem" type="file" accept="image/*">

    <button onclick="salvarEdicao(${i})">Salvar Altera√ß√µes</button>
    <button onclick="modal.style.display='none'">Cancelar</button>
  `;
}

function salvarEdicao(i) {
  const file = document.getElementById("eImagem").files[0];

  if (file) {
    const reader = new FileReader();
    reader.onload = function () {
      produtos[i].imagem = reader.result;
      atualizarProduto(i);
    };
    reader.readAsDataURL(file);
  } else {
    atualizarProduto(i);
  }
}

function atualizarProduto(i) {
  produtos[i].produto = document.getElementById("eProduto").value;
  produtos[i].preco = Number(document.getElementById("ePreco").value);
  produtos[i].promo = document.getElementById("ePromo").value;
  produtos[i].local = document.getElementById("eLocal").value;

  localStorage.setItem("produtos", JSON.stringify(produtos));

  modal.style.display = "none";
  render();
}


function excluir(i) {
  produtos.splice(i,1);
  localStorage.setItem("produtos", JSON.stringify(produtos));
  render();
}

function buscarProduto() {
  const texto = document.getElementById("campoBusca").value.toLowerCase().trim();

  const lista = texto === ""
    ? produtos
    : produtos.filter(p =>
        p.produto.toLowerCase().includes(texto)
      );

  renderProdutos(lista);
}

function cardHTML(p, i) {
  return `
  <div class="card" onclick="abrirModalIndex(${i})">
    <img src="${p.imagem}">
    <h3>${p.produto}</h3>
    <p>R$ ${p.preco}</p>
  </div>`;
}

function abrirModalIndex(i) {
  const p = produtos[i];
  modal.style.display = "flex";
  modalContent.innerHTML = `
    <img src="${p.imagem}">
    <h2>${p.produto}</h2>
    <p>Pre√ßo: R$ ${p.preco}</p>
    <p>Promo√ß√£o: ${p.promo}</p>
    <p>Local: ${p.local}</p>
    <button onclick="modal.style.display='none'">Fechar</button>
  `;
}

function abrirModal(img, prod, preco, promo, local) {
  modal.style.display="flex";
  modalContent.innerHTML = `
    <img src="${img}">
    <h2>${prod}</h2>
    <p>Pre√ßo: R$ ${preco}</p>
    <p>Promo√ß√£o: ${promo}</p>
    <p>Local: ${local}</p>
    <button onclick="modal.style.display='none'">Fechar</button>`;
}

render();
</script>

</body>
</html>
